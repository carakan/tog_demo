<h1><%= I18n.t("tog_user.plugin_title") %></h1>

<p><%= link_to I18n.t("tog_user.admin.create_user"),  new_admin_user_url, {:class => "button add", :title => I18n.t("tog_user.admin.create_user")} %></p>

<table class="tableE">
  <thead>
    <tr>
      <% [:login, :email, :state, :created_at].each do |field| %>
        <th scope="col">
          <%= link_to_sortable_column_header(field, @order_by, @sort_order,
                I18n.t("tog_user.model.#{field}")) %>
        </th>
      <% end %>
    </tr>
  </thead>
  <tfoot>
    <tr>
      <td colspan="4" class="info_results">
        <span class="info_items"><%= page_entries_info @users %></span>
        <span class="pages_navigation right">
          <%= will_paginate @users, :container => false %>
        </span>
        </td>
    </tr>
  </tfoot>
  <tbody>
    <% @users.each do |user| %>
    <tr<%= cycle(' class="pair"','') -%>>
      <td><strong><%= link_to user.login, edit_admin_user_url(user), {:title => I18n.t("tog_user.admin.edit_user")} -%></strong></td>
      <td><%= mail_to user.email, user.email, {:title => I18n.t("tog_user.admin.send_email")} -%></td>
      <td><%= I18n.t("tog_user.model.states.#{user.current_state}") %></td>
      <td><%= I18n.l(user.created_at, :format => :short) -%></td>
    </tr>
    <% end %>
  </tbody>
</table>

<% content_for :sidebar do %>
  <div id="portlet_search_user" class="portlet portletD">
    <h2>
      <span>
        <%= I18n.t("tog_user.admin.search_user") %>... 
      </span>
    </h2>
    <div class="portlet_content">
      <% form_tag(admin_users_path, :method => :get) do %>
        <%= params_hidden_fields(params, [:commit, :text]) %>
        <%= text_field_tag :text, params[:text], :size => 25 %>
        <%= submit_tag I18n.t("tog_user.admin.search") %>
      <% end %>      
      <small>
        <%= I18n.t("tog_user.admin.search_user_info") %>
      </small>
    </div>    
  </div>

  <br/> 
  <div class="portlet portletE" id="portlet_userFilter">
    <h2>
      <span>
        <%= I18n.t("tog_user.admin.filter_users") %>
      </span>
    </h2>
    <div class="portlet_content">
      <ul>
        <li>
          <ul>
            <%= filter_item(nil, nil, [:age, :state], 
                  I18n.t("tog_user.admin.filter_all")) %>
          </ul>
        </li>
        <li>
          <%= I18n.t("tog_user.admin.age_filter") %>
          <ul>
            <% [:today, :week, :month].each do |age| %>
              <%= filter_item(:age, age, [:state], 
                    I18n.t("tog_user.admin.age_filter_fields.#{age}")) %> 
            <% end %>
          </ul>
        </li>
        <li>
          <%= I18n.t("tog_user.admin.user_state_filter") %>
          <ul>
            <% [:active, :pending, :suspended].each do |state| %>
              <%= filter_item(:state, state, [:age], 
                    I18n.t("tog_user.admin.user_state_filter_fields.#{state}")) %>
            <% end %>
          </ul>        
        </li>
      </ul>
    </div>    
  </div> 
  <br/>  
<% end %>
